(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2bffcdbd"],{"13e6":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"edgeStyleContainer"},[a("div",{staticClass:"legendContainer"},[a("ul",t._l(Object.keys(t.status),function(e){return a("li",{key:e},[t._v("\n        "+t._s(e)+"\n        "),a("div",{staticClass:"legendColor",style:{background:t.status[e]}})])}),0)]),a("div",{staticClass:"toolbarContainer"},[a("ul",t._l(t.toolbarItems,function(e){return a("li",{key:e["name"],ref:"dragItem",refInFor:!0},[t._v("\n        "+t._s(e["title"])+"\n      ")])}),0)]),a("div",{ref:"container",staticClass:"graphContainer"}),a("change-status-dialog",{ref:"dialog"})],1)},s=[],r=a("6f8a"),i=a.n(r),u=(a("7f7f"),a("ac6a"),a("6762"),a("2fdb"),a("d06c")),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"改变状态",visible:t.dialogVisible,width:"30%"}},[t.R.isNil(t.mCell)?t._e():[a("el-radio-group",{model:{value:t.mStatus,callback:function(e){t.mStatus=e},expression:"mStatus"}},t._l(t.mCell["customerOptionalStatus"],function(e){return a("el-radio",{key:e,attrs:{label:e}},[t._v(t._s(e))])}),1)],a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确 定")])],1)],2)},c=[],l={name:"changeStatusDialog",data:function(){return{dialogVisible:!1,mCell:null,mStatus:""}},methods:{openDialog:function(t){var e=this;this.mCell=t,this.dialogVisible=!0,this.$nextTick(function(){e.mStatus=t["customerStatus"]})},confirm:function(){this.mCell["customerStatus"]=this.mStatus,this.dialogVisible=!1}}},f=l,g=a("2877"),d=Object(g["a"])(f,o,c,!1,null,"5424461e",null),h=d.exports,m={name:"edgeStyle",components:{ChangeStatusDialog:h},data:function(){return{rubberBand:null,status:{success:"#008000",waiting:"#808080",running:"#0000ff",failed:"#ff0000",default:"#808080"},toolbarItems:[{name:"start",title:"开始节点",defaultStatus:"success"},{name:"end",title:"结束节点",defaultStatus:"success"},{name:"node",title:"普通节点",defaultStatus:"success",OptionalStatus:["success","waiting","running","failed"]},{name:"parallel",title:"并行节点",defaultStatus:"success"},{name:"branch",title:"分支节点",defaultStatus:"waiting"},{name:"Aggregation",title:"聚合节点",defaultStatus:"success"}],statusMap:{}}},methods:{setEdgeColor:function(t,e){var a=this.R.prop("style",this.graph.view.getState(t,!0));a["strokeColor"]=e;var n="";this.R.forEachObjIndexed(function(t,e){n+="".concat(e,"=").concat(t,";")},a),t.setStyle(n),this.graph.refresh(t)},createGraph:function(){this.graph=new u["mxGraph"](this.$refs.container),this.$refs.container.style.background='url("./mxgraph/images/grid.gif")'},initGraph:function(){var t=this;this.R.isNil(this.graph)||(this.rubberBand=new u["mxRubberband"](this.graph),this.graph.setConnectable(!0),this.graph.setCellsEditable(!1),this.graph.setAllowDanglingEdges(!1),this.graph.setConnectableEdges(!1),this.graph.convertValueToString=function(e){return t.R.prop("customerTitle",e)},this.graph.addListener(u["mxEvent"].DOUBLE_CLICK,function(e,a){var n=t.R.pathOr([],["properties","cell"],a);t.R.equals("node",n["customerName"])&&t.$refs.dialog.openDialog(n)}),this.graph.connectionHandler.validateConnection=function(e,a){var n=e["customerName"],s=a["customerName"];return e!==a&&(!t.R.equals("end",n)&&(!t.R.equals("start",s)&&((!t.R.equals("parallel",s)||!(a["edges"]instanceof Array&&a["edges"].length>=1||t.R.equals("start",n)))&&((!t.R.equals("branch",s)||!t.R.equals("start",n))&&((!t.R.equals("Aggregation",s)||!t.R.equals("start",n))&&null)))))},this.graph.connectionHandler.addListener(u["mxEvent"].CONNECT,function(e,a){var n=a.getProperty("cell"),s=n["source"],r=n["target"],i=s["customerStatus"]||"default",u=s["customerName"],o=r["customerName"];if(t.setEdgeColor(n,t.status[i]),"branch"===u){var c="success"===r["customerStatus"]||"running"===r["customerStatus"]?"success":"waiting";t.setEdgeColor(n,t.status[c])}if("Aggregation"===o){var l=t.R.filter(t.R.propEq("target",r),t.R.propOr([],"edges",r)),f=t.R.map(t.R.path(["source","customerStatus"]),l);t.R.includes("waiting",f)||t.R.includes("failed",f)?r["customerStatus"]="waiting":r["customerStatus"]="success"}}))},makeItemDraggable:function(){var t=this;this.$nextTick(function(){var e=t.$refs.dragItem;!(e instanceof Array)||e.length<=0||t.R.isNil(t.graph)||e.forEach(function(e,a){var n=t.toolbarItems[a],s=function(e,a,s,r,i){t.instanceGraph(n,r,i)},r=function(){var t=document.createElement("div");return t.style.border="2px dotted black",t.style.width="50px",t.style.height="50px",t};u["mxUtils"].makeDraggable(e,t.graph,s,r(),0,0,!1,!0)})})},changeStatusHandler:function(t){var e=this,a=t["customerStatus"];this.R.propOr([],"edges",t).forEach(function(n){if(n["source"]===t){e.setEdgeColor(n,e.status[a]);var s=n["target"],r=s["customerName"];if(e.R.equals("node",r)&&("failed"===a&&(s["customerStatus"]="failed"),"waiting"!==a&&"running"!==a||(s["customerStatus"]="waiting")),e.R.equals("Aggregation",r)){var i=e.R.filter(e.R.propEq("target",s),e.R.propOr([],"edges",s)),u=e.R.map(e.R.path(["source","customerStatus"]),i);e.R.includes("waiting",u)||e.R.includes("failed",u)?s["customerStatus"]="waiting":s["customerStatus"]="success"}e.R.equals("parallel",r)&&(s["customerStatus"]="running"===a?"waiting":a)}else{var o=n["source"],c=o["customerName"];e.R.equals("branch",c)&&e.setEdgeColor(n,e.status["success"===a||"running"===a?"success":"waiting"])}})},instanceGraph:function(t,e,a){var n=this.graph.getDefaultParent();this.graph.getModel().beginUpdate();try{var s=this.statusMap,r=this.graph.insertVertex(n,null,null,e,a,50,50,""),u=this.changeStatusHandler;r.customerOptionalStatus=t["OptionalStatus"],r.customerName=t["name"],r.customerTitle=t["title"],s[r["id"]]=t["defaultStatus"],r.customer=!0,i()(r,"customerStatus",{set:function(t){s[r["id"]]=t,u(r)},get:function(){return s[r["id"]]}})}finally{this.graph.getModel().endUpdate()}}},mounted:function(){this.createGraph(),this.initGraph(),this.makeItemDraggable()}},p=m,S=(a("e216"),Object(g["a"])(p,n,s,!1,null,null,null));e["default"]=S.exports},"2fdb":function(t,e,a){"use strict";var n=a("5ca1"),s=a("d2c8"),r="includes";n(n.P+n.F*a("5147")(r),"String",{includes:function(t){return!!~s(this,t,r).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},"43ba":function(t,e,a){var n=a("d9f6"),s=a("63b6"),r=a("e4ae"),i=a("1bc3");s(s.S+s.F*a("294c")(function(){Reflect.defineProperty(n.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,e,a){r(t),e=i(e,!0),r(a);try{return n.f(t,e,a),!0}catch(s){return!1}}})},5147:function(t,e,a){var n=a("2b4c")("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(a){try{return e[n]=!1,!"/./"[t](e)}catch(s){}}return!0}},"61db":function(t,e,a){},6762:function(t,e,a){"use strict";var n=a("5ca1"),s=a("c366")(!0);n(n.P,"Array",{includes:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}}),a("9c6c")("includes")},"6f8a":function(t,e,a){t.exports=a("a440")},"7f7f":function(t,e,a){var n=a("86cc").f,s=Function.prototype,r=/^\s*function ([^ (]*)/,i="name";i in s||a("9e1e")&&n(s,i,{configurable:!0,get:function(){try{return(""+this).match(r)[1]}catch(t){return""}}})},a440:function(t,e,a){a("43ba"),t.exports=a("584a").Reflect.defineProperty},aae3:function(t,e,a){var n=a("d3f4"),s=a("2d95"),r=a("2b4c")("match");t.exports=function(t){var e;return n(t)&&(void 0!==(e=t[r])?!!e:"RegExp"==s(t))}},ac6a:function(t,e,a){for(var n=a("cadf"),s=a("0d58"),r=a("2aba"),i=a("7726"),u=a("32e9"),o=a("84f2"),c=a("2b4c"),l=c("iterator"),f=c("toStringTag"),g=o.Array,d={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},h=s(d),m=0;m<h.length;m++){var p,S=h[m],b=d[S],v=i[S],R=v&&v.prototype;if(R&&(R[l]||u(R,l,g),R[f]||u(R,f,S),o[S]=g,b))for(p in n)R[p]||r(R,p,n[p],!0)}},d2c8:function(t,e,a){var n=a("aae3"),s=a("be13");t.exports=function(t,e,a){if(n(e))throw TypeError("String#"+a+" doesn't accept regex!");return String(s(t))}},e216:function(t,e,a){"use strict";var n=a("61db"),s=a.n(n);s.a}}]);
//# sourceMappingURL=chunk-2bffcdbd.394536a5.js.map